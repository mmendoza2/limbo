<script>
    function initialize() {
        var myLatlng = new google.maps.LatLng(23.634501,-102.55278399999997);
        var mapOptions = {
            zoom: 4,
            center: myLatlng
        }
        var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

        // Place a draggable marker on the map
        var marker = new google.maps.Marker({
            position: myLatlng,
            map: map,
            draggable:true,
            title:"Your location!"
        });
        google.maps.event.addListener(marker, 'dragend', function (event) {
            document.getElementById("latbox").value = this.getPosition().lat();
            document.getElementById("lngbox").value = this.getPosition().lng();
        });
    }
    google.maps.event.addDomListener(window, 'load', initialize);
</script>
<%	 if signed_in? %>

<div class="col-md-12 col-sm-12 col-xs-12">
  <div class="row micrositiotitulocontendedor">
    <div class="col-md-4 col-sm-6 hidden-xs">

      <h1 style="color: #ffffff"><%=	@actividad.slug.capitalize %> </h1>
    </div>
    <div class="visible-xs col-xs-4">
      <h1 style="color: #ffffff; font-size: 16px"><%=	@actividad.name %> </h1>
    </div>
    <div class="col-md-8 col-sm-6 col-xs-8" style="padding-top: 15px">
          <div class="col-md-4 col-sm-6 col-xs-10 col-xs-offset-1" >
            <%= render 'follow_form' %>
          </div>
          <div class="col-md-3 col-sm-6 hidden-xs">
            <div class="fb-like" data-href="<%=request.original_url%>" data-height="The pixel height of the plugin" data-colorscheme="light" data-layout="box_count" data-action="recommend" data-show-faces="true" data-send="false"></div>
          </div>
          <div class="col-md-3 col-sm-6 hidden-xs  " >
            <a href="https://twitter.com/share" class="twitter-share-button" data-via="NTLmx" data-lang="es" data-size="large">Twittear</a>
          </div>
          <div class="col-md-2 col-sm-6 hidden-xs">
            <div class="g-plusone" data-annotation="inline" data-width="120"></div>
          </div>
    </div>
  </div>
</div>




<%	 if current_user.lat.nil? %>
    <div class="row">
      <p>Update your location</p>
    </div>
    <%= form_for(current_user, :html => { :multipart => true }) do |f| %>
        <div id="map-canvas" class="thumbnail" style="height:200px"></div>
        <div id="latlong">
          <div> <%= f.hidden_field :lat, class: 'input-sm', id: 'latbox' %></div>
          <div> <%= f.hidden_field :lng, class: 'input-sm', id: 'lngbox' %></div>
        </div>
        <div class="col-md-4 col-md-offset-4" style="margin-bottom: 10px"><%= f.submit "Update", class: 'btn btn-primary' %></div>
    <% end %>
<%	 else %>


    <div class="row">
      <p><%=	 link_to "Do you want to change your location?", edit_user_registration_path(current_user) %> </p>
    </div>
      <%	 place = ActiveSupport::JSON.decode(open("https://maps.googleapis.com/maps/api/place/nearbysearch/json?location=#{current_user.lat},#{current_user.lng}&radius=100000&types=#{@actividad.name}&sensor=false&key=AIzaSyCxH3uvobKynTSs63CoAcTQSB0xzCRduCs").read) %>
      <ul class="col-md-10 col-lg-8 col-sm-10 col-xs-12" style="padding: 0px">
        <div class="row">
        <% place['results'].each do |result| %>
          <div class="col-md-4">
              <%	 if result['photos'].nil?  %>
              <%	else  %>
                  <% result['photos'].each do |f| %>
                    <div class="img-responsive" style="height: 100px; overflow: hidden">
                      <%= image_tag("https://maps.googleapis.com/maps/api/place/photo?maxwidth=200&photoreference=#{f['photo_reference']}&sensor=true&key=AIzaSyCxH3uvobKynTSs63CoAcTQSB0xzCRduCs")  %>
                    </div>
                    <% end %>
              <%	end  %>
          </div>
            <div class="col-md-8">
              <div class="col-md-8">
                  <%= form_for(@micrositio) do |f| %>
                      <%= f.hidden_field :name, value: result['name'] %>
                      <%= f.hidden_field :reference, value: result['reference'] %>
                      <%= f.submit result['name'], class: "h4" %>
                  <% end %>
              </div>
              <div class="col-md-4">
                <%	placeinside = ActiveSupport::JSON.decode(open("https://maps.googleapis.com/maps/api/place/details/json?reference=#{result['reference']}&sensor=true&key=AIzaSyCxH3uvobKynTSs63CoAcTQSB0xzCRduCs").read) %>


                <p style="height: 100px; overflow: hidden">
                    <% result['types'].each do |types| %>
                           <%= types%>
                        <br/>
                    <% end  %>
                </p>
                <%= placeinside['rating']	  %>
              </div>
            </div>
        <% end  %>
        </div>
      </ul>
<%	 end %>




<ul>
  <%	 @actividad.micrositios.each do |x| %>
      <li> <%=	 x.name %> </li>
  <%	 end %>

</ul>





<% else %>

    <%=	 render "shared/ingresa" %>



<% end %>
