<script>
    function initialize() {
        var myLatlng = new google.maps.LatLng(23.634501,-102.55278399999997);
        var mapOptions = {
            zoom: 4,
            center: myLatlng
        }
        var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

        // Place a draggable marker on the map
        var marker = new google.maps.Marker({
            position: myLatlng,
            map: map,
            draggable:true,
            title:"Your location!"
        });
        google.maps.event.addListener(marker, 'dragend', function (event) {
            document.getElementById("latbox").value = this.getPosition().lat();
            document.getElementById("lngbox").value = this.getPosition().lng();
        });
    }
    google.maps.event.addDomListener(window, 'load', initialize);
</script>
<%	 if signed_in? %>

<div class="col-md-12 col-sm-12 col-xs-12">
  <div class="row micrositiotitulocontendedor">
    <div class="col-md-4 col-sm-6 hidden-xs">

      <h1 style="color: #ffffff"><%=	@actividad.slug.capitalize %> </h1>
    </div>
    <div class="visible-xs col-xs-4">
      <h1 style="color: #ffffff; font-size: 16px"><%=	@actividad.name %> </h1>
    </div>
    <div class="col-md-8 col-sm-6 col-xs-8" style="padding-top: 15px">
          <div class="col-md-4 col-sm-6 col-xs-10 col-xs-offset-1" >
            <%= render 'follow_form' %>
          </div>
          <div class="col-md-3 col-sm-6 hidden-xs">
            <div class="fb-like" data-href="<%=request.original_url%>" data-height="The pixel height of the plugin" data-colorscheme="light" data-layout="box_count" data-action="recommend" data-show-faces="true" data-send="false"></div>
          </div>
          <div class="col-md-3 col-sm-6 hidden-xs  " >
            <a href="https://twitter.com/share" class="twitter-share-button" data-via="NTLmx" data-lang="es" data-size="large">Twittear</a>
          </div>
          <div class="col-md-2 col-sm-6 hidden-xs">
            <div class="g-plusone" data-annotation="inline" data-width="120"></div>
          </div>
    </div>
  </div>
</div>





   <div class="col-md-12 col-sm-12 col-xs-12">
     <%	 if current_user.lat.nil? %>
         <div class="row">
           <p>Update your location</p>
         </div>
         <%= form_for(current_user, :html => { :multipart => true }) do |f| %>
             <div id="map-canvas" class="thumbnail" style="height:200px"></div>
             <div id="latlong">
               <div> <%= f.hidden_field :lat, class: 'input-sm', id: 'latbox' %></div>
               <div> <%= f.hidden_field :lng, class: 'input-sm', id: 'lngbox' %></div>
             </div>
             <div class="col-md-4 col-md-offset-4" style="margin-bottom: 10px"><%= f.submit "Update", class: 'btn btn-primary' %></div>
         <% end %>
     <%	 else %>


        <div class="row">
          <p><%=	 link_to "Do you want to change your location?", edit_user_registration_path(current_user) %> </p>
        </div>
   </div>

    <%	fbplace = ActiveSupport::JSON.decode(open("https://graph.facebook.com/search?q=#{@actividad.namefb}&type=place&center=#{current_user.lat},#{current_user.lng}&distance=10000&access_token=#{current_user.oauth_token}").read) %>
      <% fbplace['data'].first(7).each do |result| %>
         <%	fbplacein = ActiveSupport::JSON.decode(open("https://graph.facebook.com/#{result['id']}?&access_token=#{current_user.oauth_token}").read) %>
            <ul class="col-md-12 col-lg-12 col-sm-12 col-xs-12" style="padding: 0px">
              <div class="row">
                    <div class="col-md-3 col-sm-3">
                      <%	 if fbplacein['cover'].nil?  %>
                      <%	else  %>
                            <div class="img-responsive" style="height: 100px; overflow: hidden">
                              <%= image_tag(fbplacein['cover']['source'])  %>
                            </div>
                      <%	end  %>
                    </div>
                    <div class="col-md-7 col-sm-7">
                      <div class="col-md-7 col-sm-9">
                        <%= form_for(@micrositio) do |f| %>
                            <%= f.hidden_field :name, value: result['name'] %>
                            <%= f.hidden_field :referencefb, value: result['id'] %>
                            <%= f.submit result['name'], class: "h6" %>
                        <% end %>
                      </div>
                      <div class="col-md-5 col-sm-3">
                        <p style="height: 100px; overflow: hidden">
                          <% result['category_list'].each do |types| %>
                              <%= types['name'] %>
                              <br/>
                          <% end  %>
                        </p>
                      </div>
                    </div>
                    <div class="col-md-2 col-sm-2">
                      <h5> Rating</h5>
                    </div>
              </div>
            </ul>
        <%	 end %>
   <%	 place = ActiveSupport::JSON.decode(open("https://maps.googleapis.com/maps/api/place/nearbysearch/json?location=#{current_user.lat},#{current_user.lng}&radius=100000&types=#{@actividad.namegoogle}&sensor=false&key=AIzaSyCxH3uvobKynTSs63CoAcTQSB0xzCRduCs").read) %>
      <ul class="col-md-12 col-lg-12 col-sm-12 col-xs-12" style="padding: 0px">
        <div class="row">
        <% place['results'].first(7).each do |result| %>
            <div class="col-md-3 col-sm-3">
              <%	 if result['photos'].nil?  %>
              <%	else  %>
                  <% result['photos'].each do |f| %>
                    <div class="img-responsive" style="height: 100px; overflow: hidden">
                      <%= image_tag("https://maps.googleapis.com/maps/api/place/photo?maxwidth=100&photoreference=#{f['photo_reference']}&sensor=true&key=AIzaSyCxH3uvobKynTSs63CoAcTQSB0xzCRduCs")  %>
                    </div>
                    <% end %>
              <%	end  %>
            </div>
            <div class="col-md-7 col-sm-7">
                  <div class="col-md-7 col-sm-9">
                      <%= form_for(@micrositio) do |f| %>
                          <%= f.hidden_field :name, value: result['name'] %>
                          <%= f.hidden_field :reference, value: result['reference'] %>
                          <%= f.submit result['name'], class: "h6" %>
                      <% end %>
                  </div>
                  <div class="col-md-5 col-sm-3">
                 <!--   <%	placeinside = ActiveSupport::JSON.decode(open("https://maps.googleapis.com/maps/api/place/details/json?reference=#{result['reference']}&sensor=true&key=AIzaSyCxH3uvobKynTSs63CoAcTQSB0xzCRduCs").read) %> -->
                    <p style="height: 100px; overflow: hidden">
                        <% result['types'].each do |types| %>
                               <%= types%>
                            <br/>
                        <% end  %>
                    </p>
                  </div>
            </div>
            <div class="col-md-2 col-sm-2">
              <h5> Rating</h5>
              <!--        <%= placeinside['result']['rating']	  %>  -->
            </div>
        <% end  %>
        </div>
      </ul>
<%	 end %>








<% else %>

    <%=	 render "shared/ingresa" %>



<% end %>
